<!DOCTYPE html>
<html>
    <head>
        <title>GeeMail</title>
        <link rel="stylesheet" href="css/reset.css" />
        <link rel="stylesheet" href="css/style.css" media="screen">
        <script src="js/mail-generator.js"></script>
        <!-- <script src="js/app.js"></script> -->
        <script>
            // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
            // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser
            window.onload = function() {
                console.log(window.geemails);
                let tbl = document.getElementById('tbl');
                let email = 0;

                window.geemails.forEach(function(msg) {
                    loadEmail(msg)
                }); 

                function loadEmail(msg) {
                    email++;
                    // show number of messages
                    document.getElementById('inbox').innerHTML = `Inbox ${email}`;
                    
                    // create row and cell for the email
                    let rows = tbl.insertRow(1);
                    let senderCell = rows.insertCell(0);
                    senderCell.innerHTML = msg.sender;
                    let subjectCell = rows.insertCell(1);
                    subjectCell.innerHTML = msg.subject;
                    let dateCell = rows.insertCell(2);
                    dateCell.innerHTML = msg.date;
                    let body = msg.body;

                    // print-content and message
                    rows.onclick = function() {
                        let toggle = document.getElementById('message-content').innerHTML = `<b>Date:</b> ${msg.date}<br><br><b>From:</b> ${msg.sender}<br><br><b>Subject:</b> ${msg.subject}<br><br>${body}</strong>`;
                        if(toggle.style.display === "none") {
                            toggle.style.display = "block";
                        }else {
                            toggle.style.display = "none";
                        }
                    }
                    function myFunction() {
                        let toggle1 = document.getElementById('close');
                        if(toggle1.style.display === 'block') {
                            toggle1.style.display = 'none';
                        }else {
                            toggle1.style.display = 'none';
                        }
                    }
                
                };
                // render new message
                setInterval(function() {
                    loadEmail(getNewMessage());
                }, 9000);
            };
        </script>
    </head>

    <body>
        <header>
            <div id="user"><img src="https://img.icons8.com/material/30/000000/user.png"></div>
            <h1>GeeMail</h1>
            <input type="text" placeholder="Search mail..">
        </header>
        <main>
            <ul>
                <li id="inbox"><a href="#">Inbox</a></li>
                <li><a href="#">Junk</a></li>
                <li><a href="#">Deleted</a></li>
                <li><a href="#">Sent</a></li>
            </ul> 

            <div id="emails">
                <table id="tbl">
                    <thead>
                        <tr>
                            <th>Sender</th>
                            <th>Subject</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div id="message">
                <img id="close" src="https://img.icons8.com/ios-glyphs/26/000000/multiply.png" onclick="myFunction()">
                <div id="message-content"></div>
            </div>
        </main>
    </body>
</html>